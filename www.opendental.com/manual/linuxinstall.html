<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<title>Open Dental Software - Linux Server</title>
<link href="../css/manual.css" rel="stylesheet" type="text/css">
<link rel="icon" type="image/png" href="../favicon.png">
<style type="text/css">body {
	background-color: #507C77;
}
</style>
</head>

<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onKeyPress="IEKeyCapture()">
<table width="946" border="0" align="center" cellpadding="0" cellspacing="0">
  <tr>
		<td>
		<table width="100%" height="80" align="left" border="0" cellpadding="0" cellspacing="0">
			<tr>
    		<td align="left"><a href="../index.html"><img src="../open-dental/LogoInner.jpg" class="MenuImage" width="235" height="80" border="0"></a></td>
    		<td width="100%" align="left">
					<table width="100%" align="left" border="0" cellpadding="0" cellspacing="0" background="../open-dental/bg-top.jpg">
      			<tr>
        			<td height="25" align="right" valign="middle" style="padding-right:10px;">
								<a href="../index.html" class="TopLink"><img src="../open-dental/home.gif" class="MenuImage" width="17" height="15" border="0">Home</a>
								<a href="manual.html" class="TopLink"><img src="../open-dental/UserManual.gif" class="MenuImage" width="27" height="15" border="0">User Manual</a>
								<a href="http://opendentalsoft.com/forum/" class="TopLink">
										<img src="../open-dental/DiscForum.gif" class="MenuImage" width="27" height="15" border="0">Discussion Forum</a>
								<a href="../site/searchSite.html" class="TopLink"><img src="../open-dental/SearchIcon.gif" class="MenuImage" width="27" height="15" border="0">Search</a>
							</td>
						</tr>
						<tr>
        			<td height="55" align="left" valign="top"">
								<table width="100%" height="55" border="0" cellpadding="0" cellspacing="0">
            			<tr align="left" valign="top">
										<td width="20px">
										</td>
              			<td width="25%" style="padding-left:5px; padding-top:12px;">
											<ul id="Menu">
                				<li id="LIMenu"><a href="../trial.html" class="MLink"> 
													<font size="2" face="Arial, Helvetica, sans-serif" class="TopMenu">TRIAL</font><br>
                    			<font size="2" face="Arial, Helvetica, sans-serif" class="BMenu">VERSION</font> </a>
                				</li>
                  		</ul>
										</td>
                		<td align="center" valign="bottom"><img src="../open-dental/Line.gif" class="MenuImage" width="1" height="46"></td>
                		<td width="25%" style="padding-left:5px; padding-top:12px;">
											<ul id="Menu">
                  			<li id="LIMenu"><a href="../programmers-resellers.html" class="MLink">
													<font size="2" face="Arial, Helvetica, sans-serif" class="TopMenu">PROGRAMMERS</font><br>
                      		<font size="2" face="Arial, Helvetica, sans-serif" class="BMenu">& DISTRIBUTORS</font> </a>
												</li>
                  		</ul>
										</td>
                		<td valign="bottom"><img src="../open-dental/Line.gif" class="MenuImage" width="1" height="46"></td>
                		<td width="25%" style="padding-left:5px; padding-top:12px;">
											<ul id="Menu">
                  			<li id="LIMenu"><a href="https://www.opendental.com/order.html" class="MLink">
													<font size="2" face="Arial, Helvetica, sans-serif" class="TopMenu">ORDER</font><br>
                      		<font size="2" face="Arial, Helvetica, sans-serif" class="BMenu">HERE</font> </a>
												</li>
                  		</ul>
										</td>
                		<td valign="bottom"><img src="../open-dental/Line.gif" class="MenuImage" width="1" height="46"></td>
                		<td width="25%" style="padding-left:5px; padding-top:12px;">
											<ul id="Menu">
                				<li id="LIMenu"><a href="../contact.html" class="MLink">
													<font size="2" face="Arial, Helvetica, sans-serif" class="TopMenu">CONTACT</font><br>
                      		<font size="2" face="Arial, Helvetica, sans-serif" class="BMenu">INFORMATION</font> </a> </li>
                    		</ul>
											</td>
                		</tr>
              		</table>
								</td>
          		</tr>
        		</table>
					</td>
				</tr>
		</table>
		</td>
  </tr>
  <tr>
    <td bgcolor="#FFFFFF" style="padding-left:15px; padding-top:20px; padding-right:15px; background-image: url(../open-dental/Back.jpg); background-repeat: repeat-x;">
	  <h1>Linux Server</h1>
<p>See <a href="clinuxmac.html">Linux and Mac</a>.</p>
<p>Linux servers are the responsibility of the practice or IT to install. Open Dental Support cannot assist with Linux server installations or Linux server troubleshooting. </p>
<h2>MariaDB</h2>
<p class="MarginBottomZero"></p>
<ol class="MarginBottomGap">
<li>Install <a href="mariadb.html">MariaDB</a> from <a href="https://mariadb.com/kb/en/mariadb-package-repository-setup-and-usage/">RPM</a> or install package that best matches system from <a href="https://mariadb.org/download/">https://mariadb.org/download/</a>.<br/></li>
<br/><li>Setup grant tables on Linux by running the following commands. It is recommended that a password is set for the root user which can be entered between the single quotes that follow 'IDENTIFIED BY'. This is documented at: <a href="https://mariadb.com/kb/en/grant/">https://mariadb.com/kb/en/grant/</a>.<p class="codeblock">GRANT ALL ON *.* TO 'root'@'%' IDENTIFIED BY '';<br/> GRANT ALL ON *.* TO 'root'@'localhost' IDENTIFIED BY '';</p><br/></li>
<li>Edit the MariaDB configuration file named <span class="codeblock">server.cnf</span> to disable the use of InnoDB tables by default. The <span class="codeblock">server.cnf</span> file is usually located at the path <b>/etc/my.cnf.d/server.cnf</b>. Add the following text under the [mysqld] section: <p class="codeblock">default-storage-engine=MyISAM<br/> max_allowed_packet=40M<br/> max_connections=3000<br/> port=3306<br/> sql_mode=''<br/> explicit_defaults_for_timestamp=1</p><br/></li>
<li>Copy a blank or current OpenDental database to the Linux server. <ul>
<li>Each Linux installation might have a different MariaDB data location or path. The database path is documented in either <span class="codeblock">my.cnf</span> or <span class="codeblock">server.cnf</span> and is defined on a line starting with <span class="codeblock">datadir=</span>. The default path can vary and is currently <b>/var/lib/mysql</b></li>
<li>Copy the database files to a folder that is created in the data directory. For example, if the path is <b>/var/lib/mysql</b> and opendental is the name of the new database, copy to <b>/var/lib/mysql/opendental/</b>.</li>
<li>Ensure the newly created database folder has permissions for MariaDB to access the files. Either set the owner to the mysql user or set the folder permissions to allow access to all users. Open a terminal window and type one of the two commands (change the directory path to match the actual database path): <b>chown -R mysql:mysql /var/lib/mysql/opendental</b> or <b>chmod -R 777 /var/lib/mysql/opendental</b>.</li>
</ul>
</li>
</ol>
<h2>Set Up File Share (OpenDentImages)</h2>
<p>This is just like setting up any other fileshare on a Linux machine. This can be set up as desired, but all users need full permissions (read, write and delete).</p>
<p class="MarginBottomZero">A good option is to set up Samba, then set up the share. Here are some web sites with directions: </p>
<ul class="MarginBottomGap">
<li><a href="http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/">http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/</a></li>
</ul>
<p class="MarginBottomZero">Steps we followed: </p>
<ol class="MarginBottomGap">
<li>Install Webmin (<a href="http://www.webmin.com">www.webmin.com</a>). Logon as root or other user with adequate permissions. Click the Servers tab, choose Samba windows filesharing.</li>
<li>Create fileshare, then edit securities to set &lt;writeable&gt; and &lt;guest access&gt; to yes.</li>
<li>Open an SSH terminal to the Linux machine. Log on as root or other user with adequate permissions.</li>
<li>Navigate to immediate parent directory of shared directory.</li>
<li>Type chmod -R 777 foldername.</li>
<li>This process is done. ls - l will show the permissions for all of the child folders including the share.</li>
</ol>
<p>Once the share is set up, copy the contents of OpenDentImages to this new share, then set Data Paths to this location.</p>
<h2>Convert an Existing Linux Open Dental MySQL/MariaDB database to use MyISAM tables instead of InnoDB Tables</h2>
<p>In <a href="databasemaintenance.html">Database Maintenance</a> run the InnoDB tool.</p>
<p class="MarginBottomZero">Another option is below. Only consider this option if the office in question has been using the Linux server already. </p>
<ol class="MarginBottomGap">
<li>If needed, check to see if any of the current database tables are not in MyISAM format. Run the following query and replace the database name of opendental with the actual database name:<p class="codeblock">SELECT TABLE_NAME,ENGINE<br/> FROM INFORMATION_SCHEMA.TABLES<br/> WHERE TABLE_SCHEMA = 'opendental'<br/> AND ENGINE NOT LIKE 'MyISAM';</p><br/> If the query does not return any results, steps 2 - 6 do not need to be completed. </li>
<br/><li>Stop the MySQL/MariaDB service. </li>
<br/><li>Backup the database. </li>
<br/><li>Restart the MySQL/MariaDB service. </li>
<br/><li>Generate the alter table script using the following script (make name adjustments as needed). Make sure that the output folder exists and that the mysql user has full permissions on that folder. Also make sure that the output script file (see below) DOES NOT exist before running the command or else the command will fail. For example, if running the command a second time, the script previously generated must be deleted.<p class="codeblock">SET @dbname='opendental';<br/> SET @outengine='MYISAM';<br/> SELECT CONCAT('ALTER TABLE ',TABLE_NAME,' ENGINE = ',@outengine,';')<br/> FROM INFORMATION_SCHEMA.TABLES<br/> WHERE TABLE_SCHEMA = @dbname<br/> INTO OUTFILE '/tmp/mysql/myisam_convert_script.txt';</p><br/></li>
<li>Run the output script <span class="codeblock">myisam_convert_script.txt</span> in MySQL/MariaDB as follows. From a terminal window type (make changes for actual temporary script file path as needed):<p class="codeblock">mysql -u root -p opendental &lt; /tmp/mysql/myisam_convert_script.txt</p><br/></li>
<li>Edit the <span class="codeblock">server.cnf</span> file and make sure that the <span class="codeblock">skip-innodb</span> and <span class="codeblock">default-storage-engine=MyISAM</span> options are in the file on their own lines and that the lines are uncommented. Save any changes to the <span class="codeblock">server.cnf</span> file and if the file was modified then restart the MySQL/MariaDB service. This step prevents new tables from being generated as innodb tables in the future.</li>
</ol>
<h2>Troubleshooting</h2>
<p><b>During an update, receive this error: The database tables are in MyISAM format, but the default database engine format is InnoDB. You must change the default storage engine within the my.ini (or my.cnf) file on the database server must be changed and restart MySQL in order to fix this problem. Exiting.</b></p>
<p>To <span class="codeblock">server.cnf</span>, add <span class="codeblock">default-storage-engine=MyISAM</span> (Step 3 above under MariaDB)</p>
<p>Case Sensitivity: Linux MySQL/MariaDB is case sensitive by default. Open Dental tries to use only lowercase table names, however may have some mixed case variables. If ther are issues with case sensitivity, users may want to turn case sensitivity off. Simply add this line to the <span class="codeblock">server.cnf</span> file on the Linux server: <span class="codeblock">lower_case_table_names=1</span>.</p>
<p class="MarginBottomZero">Example of errors due to case sensitivity: </p>
<ul class="MarginBottomGap">
<li>MySql.Data.MySqlClient.MySqlException (0x80004005): Table 'opendental_bsm_lou_sh.ehrTrigger' doesn't exist. <p>(Notice the table name ehrTrigger is mixed case).</p>
</li>
<li>Unhandled exception trying to access the EHR Dashboard.</li>
</ul>
</td>
  </tr>
	<tr>
		<td height="80" valign="top">
			<div align="center" style="color: #FFFFFF; font-size: 11px;">Open Dental Software  1-503-363-5432</div>
		</td>
  </tr>
</table>
</body>
</html>