<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<title>Open Dental Software - One-Way Replication (random primary keys)</title>
<link href="resources/manual2.css" rel="stylesheet" type="text/css">
<script src = "resources/manualToc.js"></script>
<script src = "resources/manual.js"></script>
<link rel="icon" type="image/png" href="resources/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body onload="BodyLoaded('replicationonewayrandomprimary','replication','advancedtopics','technical','manual')">
<nav class="LeftTree">
<div class="TopBarLeft"><p>Table of Contents</p></div>
<div id="Manual"><a href="manual.html">Manual</a></div>
</nav>
<div class="RightMain">
<div class="TopBar">
    <a href="../index.html">
        <div class="Logo">
            <img src="resources/logoWhite160.png" alt="Home" width="158" height="40">
        </div>
    </a>
    <div class="TopBarLinks">
        <div class="TopBarTitle">Manual 
					<select id="SelectVersion" class="TopBarVersionDrop" onchange="location = this.options[this.selectedIndex].value;
						for (var i = 0; i < document.getElementById('SelectVersion').options.length; i++) {
							if (document.getElementById('SelectVersion').options[i].attributes.selected)
								document.getElementById('SelectVersion').selectedIndex=i;
						}"><option value="https://www.opendental.com/site/helpfeature.html">v24.4 +</option><option value="https://www.opendental.com/manual243/replicationonewayrandomprimary.html"  selected>v24.3</option><option value="https://www.opendental.com/manual242/replicationonewayrandomprimary.html" >v24.2</option><option value="https://www.opendental.com/manual241/replicationonewayrandomprimary.html" >v24.1</option><option value="https://www.opendental.com/manual233/replicationonewayrandomprimary.html" >v23.3</option><option value="https://www.opendental.com/manual232/replicationonewayrandomprimary.html" >v23.2</option><option value="https://www.opendental.com/manual231/replicationonewayrandomprimary.html" >v23.1</option><option value="https://www.opendental.com/manual224/replicationonewayrandomprimary.html" >v22.4</option><option value="https://www.opendental.com/manual223/replicationonewayrandomprimary.html" >v22.3</option><option value="https://www.opendental.com/manual222/replicationonewayrandomprimary.html" >v22.2</option><option value="https://www.opendental.com/manual221/replicationonewayrandomprimary.html" >v22.1</option><option value="https://www.opendental.com/manual214/replicationonewayrandomprimary.html" >v21.4</option><option value="https://www.opendental.com/manual213/replicationonewayrandomprimary.html" >v21.3</option><option value="https://www.opendental.com/manual212/replicationonewayrandomprimary.html" >v21.2</option><option value="https://www.opendental.com/manual211/replicationonewayrandomprimary.html" >v21.1</option><option value="https://www.opendental.com/manual205/replicationonewayrandomprimary.html" >v20.5</option><option value="https://www.opendental.com/manual204/replicationonewayrandomprimary.html" >v20.4</option><option value="https://www.opendental.com/manual203/replicationonewayrandomprimary.html" >v20.3</option><option value="https://www.opendental.com/manual202/replicationonewayrandomprimary.html" >v20.2</option><option value="https://www.opendental.com/manual201/replicationonewayrandomprimary.html" >v20.1</option><option value="https://www.opendental.com/manual194/replicationonewayrandomprimary.html" >v19.4</option><option value="https://www.opendental.com/manual193/replicationonewayrandomprimary.html" >v19.3</option><option value="https://www.opendental.com/manual192/replicationonewayrandomprimary.html" >v19.2</option><option value="https://www.opendental.com/manual191/replicationonewayrandomprimary.html" >v19.1</option><option value="https://www.opendental.com/manual184/replicationonewayrandomprimary.html" >v18.4</option><option value="https://www.opendental.com/manual183/replicationonewayrandomprimary.html" >v18.3</option><option value="https://www.opendental.com/manual182/replicationonewayrandomprimary.html" >v18.2</option><option value="https://www.opendental.com/manual181/replicationonewayrandomprimary.html" >v18.1</option><option value="https://www.opendental.com/manual174/replicationonewayrandomprimary.html" >v17.4</option></select>
				</div>        <a href="manual.html"><div class="TopBarHome"><img src="resources/home.gif"/><p>Manual<p></div></a>        <a href="searchmanual.html"><div class="TopBarSearch"><img src="resources/search.gif"/><p>Search<p></div></a>
    </div>       
</div>
<div class="TopBar2"><p>One-Way Replication (random primary keys)</p></div>
<div class="GeneralPageContent">
<p>The setup steps below are for setting up one-way <a href="replication.html">Replication</a> using random primary keys. The recommended method is to instead use auto increment variables to avoid data collision; see <a href="replicationoneway.html">One-Way Replication</a>.</p>
<p><div class="Note">Note: Versions of MySQL or MariaDB must match on all servers.</div>
</p>
<h2>Instructions</h2>
<p class="MarginBottomZero"></p>
<ol class="MarginBottomGap">
<li><b>Ensure random primary keys have already been enabled</b>. See <a href="replicationprimarykeys.html">Random Primary Keys</a>. If random primary keys are not enabled instead, see <a href="replicationoneway.html">One-Way Replication</a>.</li>
<li><b>Install the <i>OpenDentalReplicationService</i> to each Replica</b>. See <a href="opendentalreplicationservice.html">Open Dental Replication Service</a>.</li>
<li><b>Stop the MySQL Service on both the Primary and Replica (<span class="codeblock">net stop mysql</span>)</b>. On some operating systems, this will require you go into the system services in Control Panel, Administrative Tools, Services and stop the MySQL service manually. If the MySQL service is started on the Primary or Replica before step 5, then replication on the Replica will fail.</li>
<li><b>On all replication servers, wipe out all loose files in the mysql data directory which do not reside in a subfolder. </b>If all tables in all databases are MyISAM and the database management system in use is MySQL 5.5, then all of the "ib" files can be moved to a loose files folder. If all tables in all databases are MyISAM and the database management system in use is MySQL 5.6 or MariaDB 10.5 or any InnoDB tables exist in any database, the "ib" files should not be removed. </li>
<li><b>Make an identical database or data directory copy from Primary to Replica.</b> If all tables in all databases are MyISAM and the database management system in use is MySQL 5.5, a database copy from Primary to Replica is sufficient. If all tables in all databases are MyISAM and the database management system in use is MySQL 5.6 or MariaDB 10.5 or any InnoDB tables exist in any database, make an identical of the entire data directory from the Primary to Replica server. The replicated database or data directory must be exactly the same before replication begins the first time. <ul>
<li>If the one-way replication server is being added to an existing daisy chain, the database or data directory copy must be a snapshot from the point in time that the daisy chain was setup (before any SQL statements were ever replicated). If you do not have this older copy of the database or data directory, reset the daisy chain immediately before copying the database or data directory to the one-way server.</li>
</ul>
</li>
<li><b>Enable Replication by setting up the <span class="codeblock">my.ini</span> file on both the Primary and the Replica (<b>C:\Program Files (x86)\MySQL\MySQL Server 5.5</b>)</b>. Add the following lines to the <span class="codeblock">my.ini</span> file:<br/><br/><p class="codeblock">log-bin=mysql-bin</p><p class="codeblock">server-id=2</p><p class="codeblock">log-slave-updates</p><p class="codeblock">replicate-do-db=opendental</p><p class="codeblock">relay-log=server-relay-bin</p><p class="codeblock">skip-name-resolve</p><ul>
<li>Change the <span class="codeblock">server-id</span> as needed. The server ID must be unique for each replication server.</li>
<li>Change the <span class="codeblock">replicate-do-db</span> to the name of the database to replicate.</li>
<li>Change the <span class="codeblock">relay-log</span> value to include the name of the server. Ex: <span class="codeblock">relay-log=SlaveComputer-relay-bin</span></li>
</ul>
</li>
<li><b>Start the MySQL service on the Primary and Replica (<span class="codeblock">net start mysql</span>)</b>. On some operating systems, such as Windows Vista, this will require you go into the system services in Control Panel, Administrative Tools, Services and start the MYSQL service manually.</li>
<li><b>On the Replica, point the Replica to the Primary (Master)</b>. Go to the command line and change the directory to <b>C:\Program Files\MySQL\MySQL Server 5.5\bin</b> and type the following: <span class="codeblock">mysql -u root opendental</span> where <span class="codeblock">opendental</span> is the name of the database.<br/><br/><p class="codeblock">CHANGE MASTER TO</p><p class="codeblock">MASTER_HOST = 'SERVER_MASTER',</p><p class="codeblock">MASTER_USER = 'repl',</p><p class="codeblock">MASTER_PASSWORD = 'ENTER PASSWORD HERE';</p><ul>
<li>Set <span class="codeblock">MASTER_HOST</span> to either the IP address or computer name of the Primary (Master).</li>
<li>Set <span class="codeblock">MASTER_PASSWORD </span>to a password of your choosing.</li>
</ul>
</li>
<li><b>Run the following queries on the Primary to grant permission for the Replica to read data</b>. This step is easy to get wrong.<br/><br/><p class="codeblock">GRANT CREATE TEMPORARY TABLES ON opendental.* TO'repl' IDENTIFIED BY 'ENTER PASSWORD HERE';</p><p class="codeblock">GRANT SUPER ON *.* TO'repl' IDENTIFIED BY 'ENTER PASSWORD HERE';</p><p class="codeblock">GRANT REPLICATION SLAVE ON *.* TO'repl' IDENTIFIED BY 'ENTER PASSWORD HERE';</p><ul>
<li>The <span class="codeblock">opendental.*</span> should be the name of your mysql database and must be lowercase. The <span class="codeblock">.*</span> means everything within the specified database.</li>
</ul>
</li>
<li><b>Run the <span class="codeblock">START SLAVE;</span> in the mysql command interface on the Replica</b>.</li>
<li><b>Run the <span class="codeblock">SHOW SLAVE STATUS \G;</span> in the mysql command interface on the Replica</b>. Make sure that the Slave IO Running and Slave SQL Running columns both say <span class="codeblock">YES</span>. <br/><img src="images/Replication_slavestatus.png" width="505" height="519" class="ImageInParagraph"/></li>
<li>Launch Open Dental on Primary Server using LocalHost and the replicated database. Input report server settings. See <a href="reportserver.html">Report Setup: Report Server</a>.</li>
<li>Ensure replication is working as intended by performing the following: <ul>
<li>On the Primary Server, create an appointment for a test patient and make note of the patient's Patient Number, see <a href="patientedit.html">Edit Patient Information</a>. Verify the appointment was created on the Report Server by querying it from the Primary Server. Go to Reports, User Query, and ensure that the <i>Run on report server</i> box is checked before running the following query: <span class="codeblock">SELECT * FROM appointment WHERE PatNum = [Patient's PatNum]</span></li>
<li>On the Primary Server, delete the appointment and run the same query again to verify that it was removed on the report server. </li>
</ul>
</li>
</ol>
<p><b>Alternative Test</b>:</p>
<p><table class="simpletable">
<tr>
<th style="width:33%"></th>
<th style="width:33%">Master IP 192.168.0.1 <p></p>
database=databasename</th>
<th style="width:33%">Slave IP 192.168.0.2 <p></p>
database=databasename</th>
</tr>
<tr>
<td><p>Launch Open Dental on Master Server using LocalHost and the replicated database and check the log files to make sure the files were created and time stamps are recent. <b>C:\mysql\data</b></p>
</td>
<td><p><span class="codeblock">C:\mysql\data&gt;dir</span></p>
<p>02/22/2008 01:25 PM 57 relay-log.info</p>
<p>02/22/2008 09:12 PM 235 server-relay-bin.000043</p>
<p>02/22/2008 09:12 PM 26 server-relay-bin.index</p>
<p>02/22/2008 01:22 PM 17,642 server.err</p>
<p>02/22/2008 01:22 PM 5 server.pid</p>
</td>
<td><p><span class="codeblock">C:\mysql\data&gt;dir</span></p>
<p>02/22/2008 01:25 PM 57 relay-log.info</p>
<p>02/22/2008 09:12 PM 235 server-relay-bin.000043</p>
<p>02/22/2008 09:12 PM 26 server-relay-bin.index</p>
<p>02/22/2008 01:22 PM 17,642 server.err</p>
<p>02/22/2008 01:22 PM 5 server.pid</p>
</td>
</tr>
</table>
</p>
</div>
</div>
</body>
</html>