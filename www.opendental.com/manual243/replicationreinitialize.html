<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<title>Open Dental Software - Reinitialize Replication</title>
<link href="resources/manual2.css" rel="stylesheet" type="text/css">
<script src = "resources/manualToc.js"></script>
<script src = "resources/manual.js"></script>
<link rel="icon" type="image/png" href="resources/favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body onload="BodyLoaded('replicationreinitialize','replication','advancedtopics','technical','manual')">
<nav class="LeftTree">
<div class="TopBarLeft"><p>Table of Contents</p></div>
<div id="Manual"><a href="manual.html">Manual</a></div>
</nav>
<div class="RightMain">
<div class="TopBar">
    <a href="../index.html">
        <div class="Logo">
            <img src="resources/logoWhite160.png" alt="Home" width="158" height="40">
        </div>
    </a>
    <div class="TopBarLinks">
        <div class="TopBarTitle">Manual 
					<select id="SelectVersion" class="TopBarVersionDrop" onchange="location = this.options[this.selectedIndex].value;
						for (var i = 0; i < document.getElementById('SelectVersion').options.length; i++) {
							if (document.getElementById('SelectVersion').options[i].attributes.selected)
								document.getElementById('SelectVersion').selectedIndex=i;
						}"><option value="https://www.opendental.com/site/helpfeature.html">v24.4 +</option><option value="https://www.opendental.com/manual243/replicationreinitialize.html"  selected>v24.3</option><option value="https://www.opendental.com/manual242/replicationreinitialize.html" >v24.2</option><option value="https://www.opendental.com/manual241/replicationreinitialize.html" >v24.1</option><option value="https://www.opendental.com/manual233/replicationreinitialize.html" >v23.3</option><option value="https://www.opendental.com/manual232/replicationreinitialize.html" >v23.2</option><option value="https://www.opendental.com/manual231/replicationreinitialize.html" >v23.1</option><option value="https://www.opendental.com/manual224/replicationreinitialize.html" >v22.4</option><option value="https://www.opendental.com/manual223/replicationreinitialize.html" >v22.3</option><option value="https://www.opendental.com/manual222/replicationreinitialize.html" >v22.2</option><option value="https://www.opendental.com/manual221/replicationreinitialize.html" >v22.1</option><option value="https://www.opendental.com/manual214/replicationreinitialize.html" >v21.4</option><option value="https://www.opendental.com/manual213/replicationreinitialize.html" >v21.3</option><option value="https://www.opendental.com/manual212/replicationreinitialize.html" >v21.2</option><option value="https://www.opendental.com/manual211/replicationreinitialize.html" >v21.1</option><option value="https://www.opendental.com/manual205/replicationreinitialize.html" >v20.5</option><option value="https://www.opendental.com/manual204/replicationreinitialize.html" >v20.4</option><option value="https://www.opendental.com/manual203/replicationreinitialize.html" >v20.3</option><option value="https://www.opendental.com/manual202/replicationreinitialize.html" >v20.2</option><option value="https://www.opendental.com/manual201/replicationreinitialize.html" >v20.1</option><option value="https://www.opendental.com/manual194/replicationreinitialize.html" >v19.4</option><option value="https://www.opendental.com/manual193/replicationreinitialize.html" >v19.3</option><option value="https://www.opendental.com/manual192/replicationreinitialize.html" >v19.2</option><option value="https://www.opendental.com/manual191/replicationreinitialize.html" >v19.1</option><option value="https://www.opendental.com/manual184/replicationreinitialize.html" >v18.4</option><option value="https://www.opendental.com/manual183/replicationreinitialize.html" >v18.3</option><option value="https://www.opendental.com/manual182/replicationreinitialize.html" >v18.2</option><option value="https://www.opendental.com/manual181/replicationreinitialize.html" >v18.1</option><option value="https://www.opendental.com/manual174/replicationreinitialize.html" >v17.4</option></select>
				</div>        <a href="manual.html"><div class="TopBarHome"><img src="resources/home.gif"/><p>Manual<p></div></a>        <a href="searchmanual.html"><div class="TopBarSearch"><img src="resources/search.gif"/><p>Search<p></div></a>
    </div>       
</div>
<div class="TopBar2"><p>Reinitialize Replication</p></div>
<div class="GeneralPageContent">
<p>Once <a href="replication.html">Replication</a> failure has been detected, replication must be repaired before any users can access that server. The repair should be run after business hours if possible.</p>
<p>Also see <a href="replicationtroubleshooting.html">Replication Troubleshooting</a>.</p>
<p class="MarginBottomZero">Make sure to complete each numbered step before continuing on to the next step, or else replication will fail. For the steps that say <i>on all replication servers...</i> you must perform the step on all replication servers (Primary and Replicas) before continuing on to the next step. </p>
<ol class="MarginBottomGap">
<li>(Recommended) On all replication servers: Block the MySQL service network port (typically 3306) in the windows Firewall for both incoming and outgoing traffic. This step will prevent any client machines from connecting to any database while the repair is in progress.</li>
<li>Pick a database from one replication server that you think is the most up-to-date database. We will refer to the server where this database is located the 'Primary' and all other replication servers 'Replicas' in the text below.</li>
<li>On the Primary server, in the <a href="mainmenu.html">Main Menu</a>, click Setup, Advanced Setup, Replication. Click Clear at the lower right. If this button is not visible, the replication failure was not detected in the database, so skip this step and proceed to step 4. <br/><img src="images/replicationFailure.gif" width="341" height="66" class="ImageInParagraph"/></li>
<li>On all replication servers: <ol>
<li>Run the following SQL statement: <span class="codeblock">STOP SLAVE;</span> (This stops the replication thread within MySQL.)</li>
<li>Stop the MySQL service.</li>
<li>Backup and remove all files in the mysql data directory which do not reside in a subfolder, except for any files beginning with <span class="codeblock">ib</span> (e.g. <span class="codeblock">iblog_file0</span>, <span class="codeblock">ib_logfile1</span>, <span class="codeblock">ibdata1</span>).</li>
</ol>
</li>
<li>On all Replica servers (not the Primary): Backup and remove the current replicated database (typically named opendental) from the data directory or the entire data directory depending on database management system or storage engine. <ul>
<li>If all tables in all databases are MyISAM and the database management system in use is MySQL 5.5, only backup and remove the replicated database. </li>
<li>If all tables in all databases are MyISAM and the database management system in use is MySQL 5.6 or MariaDB 10.5 or any InnoDB tables exist in any database, backup and remove the entire data directory.</li>
</ul>
<div class="Note">Note: You must fully complete the steps 4 and 5 on all replication servers before proceeding to step 6 or replication will fail. </div>
</li>
<li>Copy the database folder or data directory on the Primary to all Replica servers.</li>
<li>On all replication servers: Repeat steps 6 - 10 from setup. <a href="replicationdaisychain.html">Daisy Chain Replication</a>, <a href="replicationoneway.html">One-Way Replication</a></li>
<li>On all replication servers: Verify that replication is running successfully by executing the following SQL statement and checking for the <span class="codeblock">Slave_IO_Running</span> and <span class="codeblock">Slave_SQL_Running</span> columns to both say <span class="codeblock">Yes</span>: <span class="codeblock">SHOW SLAVE STATUS;</span></li>
<li>On all replication servers: If you blocked the MySQL service network port in step 1, unblock it, making sure to unblock incoming and outgoing.</li>
</ol>
<h2>Alternate Repair</h2>
<p>If the database is very large, then the above repair scenario may not be feasible. If you have a deeper understanding of replication and expertise in restarting failed replication, you might consider restarting replication and running all the queries below the failure point in the log.</p>
<p>MySQL also provides an enterprise monitor software that will graphically show your replication loop and will let you monitor the status of each server and how many seconds each one is behind its Primary. While this is a very useful tool, it is also expensive.</p>
</div>
</div>
</body>
</html>