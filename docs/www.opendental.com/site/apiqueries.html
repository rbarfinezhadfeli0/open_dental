<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

	<title>Open Dental Software - API Queries</title>
	<link href="resources/siteWithTree.css" rel="stylesheet" type="text/css">
	<link href="../css/common.css" rel="stylesheet" type="text/css">
	<script src = "resources/siteWithTreeToc.js"></script>
	<script src = "resources/siteWithTree.js"></script>
	<link rel="icon" type="image/png" href="resources/favicon.png">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body onload="BodyLoaded('apiqueries','apispecification','documentation')">
	<nav class="LeftTree">
		<div class="TopBarLeft"><p>Table of Contents</p></div>
		<div id="TocTree"><a href="https://www.opendental.com/site/help.html">Help</a></div>
	</nav>
	<div class="RightMain">
		<div class="TopBar">
			<a href="../index.html">
				<div class="Logo">
					<img src="resources/logoWhite160.png" alt="Home" width="158" height="40">
				</div>
			</a>
			<div class="TopBarLinks">
				<div class="TopBarTitle"></div>
				<a href="searchSite.html">
					<div class="TopBarSearch">
						<img src="resources/search.gif"/>
						<p>Search<p>
					</div>
				</a>
			</div>
		</div>
		<div class="TopBar2"><p>API Queries</p></div>
		<div class="GeneralPageContent">
<p>See <a href="apispecification.html">API Specification</a></p>
<p>Runs a custom query against the database. Queries are screened to be read-only. Temporary tables are allowed. Any command that would change the database will not be run. The Audit Trail for these requests includes the command that was run.</p>
<p>Rarely, an office will insist on higher security for queries. There is a OpenDentalWebConfig.xml file in the eConnector installation folder. This config file has two tags that are normally empty: &lt;UserLow&gt; and &lt;PasswordLow&gt;. You can set up a different MySQL that has more restrictive permissions than the MySQL user used for all the other API methods. Once this MySQL user is set up, enter their username and password into &lt;UserLow&gt; and &lt;PasswordLow&gt;, and that user will be used here for queries. If those tags are blank, then the regular MySQL user will be used. Don't remove those tags, or the eConnector won't start.</p>
<p> Important: Data stored in Open Dental should never include null bytes (\0) in database fields. Including null byte escape sequences (e.g., '\\0', '\0') in your SQL is unnecessary and may cause failures during transit or deserialization. If null filtering is absolutely required, use CHAR(0) instead.</p>
<h2>Queries POST</h2>
<p>Version Added: 21.1</p>
<p>The results of the query are written to a file and saved to the SFTP site specified in the JSON. Directory will be created if it does not exist, and files already existing with the specified name will be overwritten. Query results are written in comma-delimited CSV format. If there are no results, then the file will only contain "OK".</p>
<p><b>SqlCommand: </b>Required. <br><b>SftpAddress: </b>Required. Specify the full path of the file (using /). The user with the SFTP credentials must have write permission in this directory. <br><b>SftpUsername: </b>Required.<br><b>SftpPassword: </b>Required. <br><br><b>SftpPort: </b>Optional. Default port 22. <br><b>IsAsync: </b>(Added in version 23.3.26) Optional. Either "true" or "false". When "true" the request will return once the <b>SqlCommand</b> is complete and then only the file transfer will continue asynchronously. Default "false".<br></p>
<p><b>Example Requests:</b><br> POST /queries<br></p>
<p><span class="codeblock"> {<br>  "SqlCommand": "SELECT PatPlanNum, PatNum, InsSubNum FROM patplan",<br>  "SftpAddress": "MySftpSite/myUsername/Patient Plans/PatPlans-35.csv",<br>  "SftpPort": 25,<br>  "SftpUsername": "myUsername",<br>  "SftpPassword": "myPassword"<br> }<br></span></p>
<p>or </p>
<p><span class="codeblock"> {<br>  "SqlCommand": " SELECT * FROM patient WHERE Birthdate LIKE '%-06-22' ",<br>  "SftpAddress": "MySftpSite/myUsername/Birthdays/Jun22.csv",<br>  "SftpUsername": "myUsername",<br>  "SftpPassword": "myPassword"<br> }<br></span></p>
<p>or </p>
<p><span class="codeblock"> {<br>  "SqlCommand": "SELECT * FROM InsSub WHERE DateTerm &lt; '2021-01-01'",<br>  "SftpAddress": "MySftpSite/myUsername/Insurance Subscriptions/Expired2021.csv",<br>  "SftpUsername": "myUsername",<br>  "SftpPassword": "myPassword"<br> }<br></span></p>
<p><b>Example Response:</b><br> 201 Created<br> 400 BadRequest (SQL syntax and Sftp connection errors)<br> 401 Unauthorized (Query is not read-only or is not executing on temporary tables)<br></p>
<h2>Queries PUT ShortQuery</h2>
<p>Version Added: 21.2</p>
<p>Returning at most 100 rows. The results of the query are returned as a data table in the JSON. While pagination is supported for results that return over 100 rows, it is recommended to instead use Queries POST for longer results.</p>
<p><b>Example Requests:</b><br> PUT /queries/ShortQuery<br> PUT /queries/ShortQuery?Offset=200<br></p>
<p><span class="codeblock"> {<br>  "SqlCommand": "SELECT LName, FName, HmPhone, WkPhone, WirelessPhone, Email<br> FROM patient<br> WHERE PatNum IN(876,2456,3892,5713,1234,6987,4321,7542,1890,5678,9012,3456)"<br> }<br></span></p>
<p>or </p>
<p><span class="codeblock"> {<br>  "SqlCommand": "SELECT clinic.Description, COUNT(*) AS NumberOfPatients <br> FROM patient,clinic <br> WHERE patient.ClinicNum=clinic.ClinicNum <br> GROUP BY clinic.ClinicNum"<br> }<br></span></p>
<p>or </p>
<p><span class="codeblock"> {<br>  "SqlCommand": "SELECT * FROM payperiod"<br> }<br></span></p>
<p><b>Example Responses:</b><br><span class="codeblock">[<br> {<br>  "PayPeriodNum": 200,<br>  "DateStart": "2021-05-01T00:00:00",<br>  "DateStop": "2021-05-31T00:00:00",<br>  "DatePaycheck": "2021-06-04T00:00:00"<br> },<br> {<br>  "PayPeriodNum": 201,<br>  "DateStart": "2021-06-01T00:00:00",<br>  "DateStop": "2021-06-30T00:00:00",<br>  "DatePaycheck": "2021-07-05T00:00:00"<br> }<br> ]<br></span> 200 OK<br> 400 BadRequest (SQL syntax errors)<br> 401 Unauthorized (Query is not read-only or is not executing on temporary tables)<br></p>
		</div>
	</div>
</body>
</html>